{"version":3,"file":"jss-plugin-global.js","sources":["../../../node_modules/@babel/runtime/helpers/esm/extends.js","../src/index.js"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","// @flow\nimport {\n  RuleList,\n  type Plugin,\n  type RuleOptions,\n  type ContainerRule,\n  type StyleRule,\n  type BaseRule\n} from 'jss'\n\nconst at = '@global'\nconst atPrefix = '@global '\n\nclass GlobalContainerRule implements ContainerRule {\n  type = 'global'\n\n  at: string = at\n\n  rules: RuleList\n\n  options: RuleOptions\n\n  key: string\n\n  isProcessed: boolean = false\n\n  constructor(key, styles, options: RuleOptions) {\n    this.key = key\n    this.options = options\n    this.rules = new RuleList({\n      ...options,\n      parent: this\n    })\n\n    for (const selector in styles) {\n      this.rules.add(selector, styles[selector])\n    }\n\n    this.rules.process()\n  }\n\n  /**\n   * Get a rule.\n   */\n  getRule(name) {\n    return this.rules.get(name)\n  }\n\n  /**\n   * Create and register rule, run plugins.\n   */\n  addRule(name, style, options) {\n    const rule = this.rules.add(name, style, options)\n    if (rule) this.options.jss.plugins.onProcessRule(rule)\n    return rule\n  }\n\n  /**\n   * Get index of a rule.\n   */\n  indexOf(rule) {\n    return this.rules.indexOf(rule)\n  }\n\n  /**\n   * Generates a CSS string.\n   */\n  toString() {\n    return this.rules.toString()\n  }\n}\n\nclass GlobalPrefixedRule implements BaseRule {\n  type = 'global'\n\n  at: string = at\n\n  options: RuleOptions\n\n  rule: BaseRule | null\n\n  isProcessed: boolean = false\n\n  key: string\n\n  constructor(key, style, options) {\n    this.key = key\n    this.options = options\n    const selector = key.substr(atPrefix.length)\n    this.rule = options.jss.createRule(selector, style, {\n      ...options,\n      parent: this\n    })\n  }\n\n  toString(options) {\n    return this.rule ? this.rule.toString(options) : ''\n  }\n}\n\nconst separatorRegExp = /\\s*,\\s*/g\n\nfunction addScope(selector, scope) {\n  const parts = selector.split(separatorRegExp)\n  let scoped = ''\n  for (let i = 0; i < parts.length; i++) {\n    scoped += `${scope} ${parts[i].trim()}`\n    if (parts[i + 1]) scoped += ', '\n  }\n  return scoped\n}\n\nfunction handleNestedGlobalContainerRule(rule, sheet) {\n  const {options, style} = rule\n  const rules = style ? style[at] : null\n\n  if (!rules) return\n\n  for (const name in rules) {\n    sheet.addRule(name, rules[name], {\n      ...options,\n      selector: addScope(name, rule.selector)\n    })\n  }\n\n  delete style[at]\n}\n\nfunction handlePrefixedGlobalRule(rule, sheet) {\n  const {options, style} = rule\n  for (const prop in style) {\n    if (prop[0] !== '@' || prop.substr(0, at.length) !== at) continue\n\n    const selector = addScope(prop.substr(at.length), rule.selector)\n    sheet.addRule(selector, style[prop], {\n      ...options,\n      selector\n    })\n    delete style[prop]\n  }\n}\n\n/**\n * Convert nested rules to separate, remove them from original styles.\n *\n * @param {Rule} rule\n * @api public\n */\nexport default function jssGlobal(): Plugin {\n  function onCreateRule(name, styles, options) {\n    if (!name) return null\n\n    if (name === at) {\n      return new GlobalContainerRule(name, styles, options)\n    }\n\n    if (name[0] === '@' && name.substr(0, atPrefix.length) === atPrefix) {\n      return new GlobalPrefixedRule(name, styles, options)\n    }\n\n    const {parent} = options\n\n    if (parent) {\n      if (\n        parent.type === 'global' ||\n        (parent.options.parent && parent.options.parent.type === 'global')\n      ) {\n        options.scoped = false\n      }\n    }\n\n    if (options.scoped === false) {\n      options.selector = name\n    }\n\n    return null\n  }\n\n  function onProcessRule(rule, sheet) {\n    if (rule.type !== 'style' || !sheet) return\n\n    handleNestedGlobalContainerRule(((rule: any): StyleRule), sheet)\n    handlePrefixedGlobalRule(((rule: any): StyleRule), sheet)\n  }\n\n  return {onCreateRule, onProcessRule}\n}\n"],"names":["at","atPrefix","GlobalContainerRule","key","styles","options","type","rules","isProcessed","RuleList","parent","selector","add","process","getRule","name","get","addRule","style","rule","jss","plugins","onProcessRule","indexOf","toString","GlobalPrefixedRule","substr","length","createRule","separatorRegExp","addScope","scope","parts","split","scoped","i","trim","handleNestedGlobalContainerRule","sheet","handlePrefixedGlobalRule","prop","jssGlobal","onCreateRule"],"mappings":"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"}